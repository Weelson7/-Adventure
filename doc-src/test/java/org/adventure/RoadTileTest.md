# RoadTileTest

**Package:** `org.adventure`  
**Type:** Unit Test  
**Phase:** 1.10.2  
**Status:** ✅ Complete  
**Coverage:** 11 tests, 100% line coverage

## Overview

Tests for `RoadTile` data model. Validates Builder pattern, upgrade logic, traffic management, and road progression (DIRT → STONE → PAVED).

## Test Categories

### Builder Pattern (3 tests)
- `testRoadTileBuilder()` — Complete construction with all fields
- `testRoadTileBuilderDefaults()` — Default values (DIRT, traffic=0, autoGen=true)
- `testRoadTileBuilderPosition()` — Position shorthand method

### Traffic Management (2 tests)
- `testIncrementTraffic()` — Add traffic to road
- `testIncrementTrafficCap()` — Traffic caps at 100

### Upgrade Logic (5 tests)
- `testTryUpgradeDirtToStone()` — DIRT → STONE at 50+ traffic
- `testTryUpgradeStoneToStone()` — STONE stays STONE below 80 traffic
- `testTryUpgradeStoneToPaved()` — STONE → PAVED at 80+ traffic
- `testTryUpgradePavedNoUpgrade()` — PAVED is max tier
- `testAutoUpgradeFlow()` — Full progression DIRT → STONE → PAVED

### Metadata (1 test)
- `testSchemaVersion()` — Default schema version is 1

## Key Tests

### testRoadTileBuilder
```java
@Test
public void testRoadTileBuilder() {
    RoadTile road = new RoadTile.Builder()
        .x(10)
        .y(20)
        .type(RoadType.DIRT)
        .createdTick(1000)
        .trafficLevel(25)
        .isAutoGenerated(true)
        .build();
    
    assertEquals(10, road.getX());
    assertEquals(20, road.getY());
    assertEquals(RoadType.DIRT, road.getType());
    assertEquals(1000, road.getCreatedTick());
    assertEquals(25, road.getTrafficLevel());
    assertTrue(road.isAutoGenerated());
}
```

### testIncrementTrafficCap
```java
@Test
public void testIncrementTrafficCap() {
    RoadTile road = new RoadTile.Builder()
        .x(10)
        .y(20)
        .createdTick(1000)
        .trafficLevel(95)
        .build();
    
    road.incrementTraffic(10);
    assertEquals(100, road.getTrafficLevel());  // Capped at 100
}
```

### testAutoUpgradeFlow
```java
@Test
public void testAutoUpgradeFlow() {
    RoadTile road = new RoadTile.Builder()
        .x(10)
        .y(20)
        .createdTick(1000)
        .build();
    
    assertEquals(RoadType.DIRT, road.getType());
    
    // Simulate traffic accumulation to 50
    for (int i = 0; i < 50; i++) {
        road.incrementTraffic(1);
    }
    
    assertTrue(road.tryUpgrade());
    assertEquals(RoadType.STONE, road.getType());
    
    // Continue traffic to 80
    for (int i = 0; i < 30; i++) {
        road.incrementTraffic(1);
    }
    
    assertTrue(road.tryUpgrade());
    assertEquals(RoadType.PAVED, road.getType());
    
    // No more upgrades
    assertFalse(road.tryUpgrade());
}
```

## Upgrade Rules

| From  | Traffic Threshold | To    | Test Method |
|-------|-------------------|-------|-------------|
| DIRT  | 50+               | STONE | testTryUpgradeDirtToStone |
| STONE | 80+               | PAVED | testTryUpgradeStoneToPaved |
| PAVED | N/A               | (max) | testTryUpgradePavedNoUpgrade |

## Validation Tests

### Traffic Constraints
- `trafficLevel` — Must be 0-100 (validated in constructor)
- `incrementTraffic()` — Automatically caps at 100

### Upgrade Thresholds
- DIRT → STONE: requires `trafficLevel >= 50`
- STONE → PAVED: requires `trafficLevel >= 80`
- PAVED: no further upgrades

## Test Results

```
[INFO] Running org.adventure.RoadTileTest
[INFO] Tests run: 11, Failures: 0, Errors: 0, Skipped: 0
```

**Success Rate:** 100%  
**Execution Time:** < 1 second

## Related Classes

- `RoadTile` — Class under test
- `RoadType` — Enum used in tests
- `RoadGenerator` — (Planned) Integration tests

## References

- **Source:** `src/main/java/org/adventure/settlement/RoadTile.java`  
- **Design:** `BUILD_PHASE1.10.x.md` → Phase 1.10.2
